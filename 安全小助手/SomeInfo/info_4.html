<!doctype html>
<html>

	<head>
		<meta charset="UTF-8">
		<title></title>
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">
		<link rel="stylesheet" href="../css/mui.min.css">
		<style>			
			.mui-bar {
				background: #fff;
			}
			
			#span_left {
				float: left;
				color: #000
			}
			
			#span_right {
				float: right
			}
			
			.mui-scroll-wrapper {
				-webkit-overflow-scrolling: touch;
				overflow-y: scroll;
			}				
		</style>
	</head>

	<body>
		<header id="title" class="mui-bar mui-bar-nav">
			<a id="close" class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left"></a>
			<h1 class="mui-title">专职人员持证</h1>
		</header>
		<div id="main" class="mui-content">
			<div class="mui-scroll">
				<ul id="majorStaffList" class="mui-table-view mui-table-view-chevron">
				</ul>
			</div>
		</div>
		<script src="../js/mui.min.js"></script>
		<script type="text/javascript">
			var baseUrl = "http://123.206.87.22";
			var subsidiaryId;
			var companyId;
			var supervisionCompanyId;
			
			mui.init();
			mui.plusReady(function() {			
				var self = plus.webview.currentWebview();
				var from = self.from;
//				if(mui.os.ios && from!=1)
//					document.getElementById("title").style.marginTop = "40px";				
				var userClass = self.userClass;
				companyId = self.companyId;
				var userId = self.userId;
				subsidiaryId = self.subsidiaryId;
				supervisionCompanyId = self.supervisionCompanyId;				
				var old_back = mui.back;
				mui.back = function() {
					var w = plus.webview.getWebviewById("tab-webview-subpage-project.html");
					var self = plus.webview.currentWebview();
					if(from != 1){
						self.parent().evalJS('mui.back();');
					}
					self.close();
					old_back();
				};

				if(from == 1) {
					var request_url = baseUrl + "/subsidiary/majorStaff?subsidiaryId=" + subsidiaryId;
					console.log(request_url);
					var headers = {
						'Accept': 'application/json',
						'Content-Type': 'application/json;charset=utf-8',
					};
					mui.ajax(request_url, {
						type: "get",
						success: function(result) {
							var extend = eval(result.extend);
							var majorStaffList = extend.list;
							for(var i = 0; i < majorStaffList.length; i++) {
								var majorStaffId = majorStaffList[i].majorStaffId;
								var majorStaffImgPath = majorStaffList[i].majorStaffImgPath;
								var job = majorStaffList[i].job;
								var name = majorStaffList[i].name;
								var idNumber = majorStaffList[i].idNumber;
								var majorStaffIdNumber = majorStaffList[i].majorStaffIdNumber;
								var category = majorStaffList[i].category;
								var currentState = majorStaffList[i].currentState;
								addmajorStaff(majorStaffId, majorStaffImgPath, job, name, idNumber, majorStaffIdNumber, category, currentState);
							}
						},
						error: function() {
							plus.nativeUI.toast("请求失败!");
						}
					});
				}
				if(from == 2) {
					var request_url = baseUrl + "/company/majorStaff?companyId=" + companyId;
					console.log(request_url);
					var headers = {
						'Accept': 'application/json',
						'Content-Type': 'application/json;charset=utf-8',
					};
					mui.ajax(request_url, {
						type: "get",
						success: function(result) {
							var extend = eval(result.extend);
							var majorStaffList = extend.list;
							for(var i = 0; i < majorStaffList.length; i++) {
								var majorStaffId = majorStaffList[i].majorStaffId;
								var majorStaffImgPath = majorStaffList[i].majorStaffImgPath;
								var job = majorStaffList[i].job;
								var name = majorStaffList[i].name;
								var idNumber = majorStaffList[i].idNumber;
								var majorStaffIdNumber = majorStaffList[i].majorStaffIdNumber;
								var category = majorStaffList[i].category;
								var currentState = majorStaffList[i].currentState;
								addmajorStaff(majorStaffId, majorStaffImgPath, job, name, idNumber, majorStaffIdNumber, category, currentState);
							}
						},
						error: function() {
							plus.nativeUI.toast("请求失败!");
						}
					});
				}
				if(from == 3) {
					var request_url = baseUrl + "/supervisionCompany/majorStaff?supervisionCompanyId=" + supervisionCompanyId;
					console.log(request_url);
					var headers = {
						'Accept': 'application/json',
						'Content-Type': 'application/json;charset=utf-8',
					};
					mui.ajax(request_url, {
						type: "get",
						success: function(result) {
							var extend = eval(result.extend);
							var majorStaffList = extend.list;
							for(var i = 0; i < majorStaffList.length; i++) {
								var majorStaffId = majorStaffList[i].majorStaffId;
								var majorStaffImgPath = majorStaffList[i].majorStaffImgPath;
								var job = majorStaffList[i].job;
								var name = majorStaffList[i].name;
								var idNumber = majorStaffList[i].idNumber;
								var majorStaffIdNumber = majorStaffList[i].majorStaffIdNumber;
								var category = majorStaffList[i].category;
								var currentState = majorStaffList[i].currentState;
								addmajorStaff(majorStaffId, majorStaffImgPath, job, name, idNumber, majorStaffIdNumber, category, currentState);
							}
						},
						error: function() {
							plus.nativeUI.toast("请求失败!");
						}
					});
				}				
			});

			mui('.mui-table-view').on('tap', '.mui-table-view-cell', function(e) {
				var node = this.childNodes;
				var majorStaffId = node[0].value;
				var majorStaffImgPath = node[1].value;
				var job = node[2].value;
				var name = node[3].value;
				var idNumber = node[4].value;
				var majorStaffIdNumber = node[5].value;
				var category = node[6].value;
				var currentState = node[7].value;
				mui.openWindow({
					url: "info_4_.html",
					id: "info_4_",
					extras: {
						companyId: companyId,
						majorStaffId: majorStaffId,
						majorStaffImgPath: majorStaffImgPath,
						job: job,
						name: name,
						idNumber: idNumber,
						majorStaffIdNumber: majorStaffIdNumber,
						category: category,
						currentState: currentState
					}
				});
			});

			function addmajorStaff(majorStaffId, majorStaffImgPath, job, name, idNumber, majorStaffIdNumber, category, currentState) {
				var main = document.getElementById("main");
				var ul = document.getElementById("majorStaffList");
				var liObj = document.createElement("li");
				var a = document.createElement("p");
				var span_num = document.createElement("span");
				span_num.setAttribute("id", "span_left");
				span_num.innerHTML = job;
				var span_other = document.createElement("span");
				span_other.setAttribute("id", "span_left");
//				if(category == "1")
//					span_other.innerHTML = "项目";
//				else if(category == "2")
//					span_other.innerHTML = "监理";
//				else
//					span_other.innerHTML = "业主";
				span_other.innerHTML = name;
				liObj.setAttribute("class", "mui-table-view-cell");
				a.setAttribute("class", "mui-navigate-right");
				a.setAttribute("id", majorStaffId);
				a.appendChild(span_num);
				a.appendChild(document.createElement("br"));
				a.appendChild(span_other);
				a.appendChild(document.createElement("br"));
				var span_id = document.createElement("span");
				span_id.setAttribute("id", "span_right");
				span_id.innerHTML = majorStaffIdNumber;
				a.appendChild(span_id);
				var hidden_input = document.createElement("input");
				hidden_input.setAttribute("type", "hidden");
				hidden_input.setAttribute("id", "majorStaffId");
				hidden_input.setAttribute("value", majorStaffId);
				liObj.appendChild(hidden_input);
				var hidden_input = document.createElement("input");
				hidden_input.type = "hidden";
				hidden_input.id = "majorStaffImgPath";
				hidden_input.value = majorStaffImgPath;
				liObj.appendChild(hidden_input);
				var hidden_input = document.createElement("input");
				hidden_input.type = "hidden";
				hidden_input.id = "job";
				hidden_input.value = job;
				liObj.appendChild(hidden_input);
				var hidden_input = document.createElement("input");
				hidden_input.type = "hidden";
				hidden_input.id = "name";
				hidden_input.value = name;
				liObj.appendChild(hidden_input);
				var hidden_input = document.createElement("input");
				hidden_input.type = "hidden";
				hidden_input.id = "idNumber";
				hidden_input.value = idNumber;
				liObj.appendChild(hidden_input);
				var hidden_input = document.createElement("input");
				hidden_input.type = "hidden";
				hidden_input.id = "majorStaffIdNumber";
				hidden_input.value = majorStaffIdNumber;
				liObj.appendChild(hidden_input);
				var hidden_input = document.createElement("input");
				hidden_input.type = "hidden";
				hidden_input.id = "category";
				hidden_input.value = category;
				liObj.appendChild(hidden_input);
				var hidden_input = document.createElement("input");
				hidden_input.type = "hidden";
				hidden_input.id = "currentState";
				hidden_input.value = currentState;
				liObj.appendChild(hidden_input);
				liObj.appendChild(a);
				ul.appendChild(liObj);
			}

			document.getElementById("close").addEventListener("tap", function() {
				var w = plus.webview.getWebviewById("tab-webview-subpage-project.html");
				var self = plus.webview.currentWebview();
				self.parent().evalJS('mui.back();');
				self.close();
			});
		</script>
	</body>

</html>